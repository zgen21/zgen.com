datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String           @id @default(cuid())
  email        String           @unique
  passwordHash String
  name         String?
  handle       String           @unique
  language     String           @default("en")
  country      String?
  aiTier       String           @default("basic") // 'basic','pro','elite'
  createdAt    DateTime         @default(now())

  preferences  UserPreferences?
  clicks       Click[]
  earnings     UserEarnings[]
}

model UserPreferences {
  userId          String   @id
  user            User     @relation(fields: [userId], references: [id])
  categories      String[]
  minPrice        Float?
  maxPrice        Float?
  targetCountries String[]
  updatedAt       DateTime @default(now())
}

model AffiliateProduct {
  id              String   @id @default(cuid())
  source          String   // e.g. 'amazon_in'
  sourceProductId String
  title           String
  description     String?
  imageUrl        String?
  price           Float
  currency        String
  rating          Float?
  category        String
  productUrl      String
  lastSyncedAt    DateTime @default(now())

  clicks          Click[]
}

model Click {
  id          String           @id @default(cuid())
  user        User?            @relation(fields: [userId], references: [id])
  userId      String?
  product     AffiliateProduct @relation(fields: [productId], references: [id])
  productId   String
  shopHandle  String?
  createdAt   DateTime @default(now())
  ip          String?
  userAgent   String?
}

model UserEarnings {
  id              String   @id @default(cuid())
  user            User     @relation(fields: [userId], references: [id])
  userId          String
  orderReference  String
  grossCommission Float
  userShare       Float
  platformShare   Float
  revenueType     String   // 'product_sale','service_sale','ai_subscription'
  source          String   // 'affiliate','direct_marketplace'
  createdAt       DateTime @default(now())
}
